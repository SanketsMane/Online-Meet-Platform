<!doctype html>
<html lang="en" class="no-js">
    <head>
        <title>tawktoo - Developer Portal</title>
        <link rel="shortcut icon" href="../images/logo.svg" />
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        
        <!-- Premium Fonts & Icons -->
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />

        <!-- Tailwind Configuration -->
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                darkMode: 'class',
                theme: {
                    extend: {
                        fontFamily: { sans: ['Inter', 'sans-serif'] },
                        colors: {
                            brand: { 50: '#f5f7ff', 100: '#ebf0fe', 200: '#ced9fd', 300: '#b1c2fc', 400: '#7695fa', 500: '#3b68f8', 600: '#355de0', 700: '#2c4ebb', 800: '#233e95', 900: '#1d337a' },
                            slate: { 900: '#0f172a', 800: '#1e293b', 700: '#334155' }
                        }
                    }
                }
            }
        </script>

        <!-- Functional Scripts -->
        <script defer src="../js/Brand.js"></script>
        <script defer src="../js/Theme.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.8"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <style>
            :root { --sidebar-width: 280px; }
            body { font-family: 'Inter', sans-serif; }
            
            /* Minimalist table styles */
            .pro-table th { @apply px-6 py-4 text-left text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] border-b border-slate-100 dark:border-slate-800; }
            .pro-table td { @apply px-6 py-5 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300 border-none; }
            .pro-table tr { @apply transition-all duration-200 hover:bg-slate-50/50 dark:hover:bg-slate-800/30; }
            
            /* Sidebar transitions */
            .sidebar { width: var(--sidebar-width); @apply transition-all duration-300 ease-in-out border-r border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900; }
            .content-area { margin-left: var(--sidebar-width); @apply transition-all duration-300 min-h-screen bg-slate-50 dark:bg-slate-950; }
            
            @media (max-width: 1024px) {
                .sidebar { transform: translateX(-100%); position: fixed; height: 100vh; z-index: 50; }
                .sidebar.open { transform: translateX(0); }
                .content-area { margin-left: 0; }
            }

            /* Custom scrollbar */
            ::-webkit-scrollbar { width: 6px; height: 6px; }
            ::-webkit-scrollbar-track { @apply bg-transparent; }
            ::-webkit-scrollbar-thumb { @apply bg-slate-300 dark:bg-slate-700 rounded-full; }

            /* Modern Code Blocks */
            .code-block { @apply rounded-xl overflow-hidden bg-slate-900 border border-slate-800 shadow-2xl; }
            .code-header { @apply flex items-center justify-between px-4 py-2 bg-slate-800/50 border-b border-slate-800; }
            
            /* Glassmorphism Refined */
            .glass-panel { @apply bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 shadow-sm transition-all duration-300; }
            .glass-panel:hover { @apply shadow-md border-slate-200 dark:border-slate-700; }
        </style>
    </head>
    <body class="dark:bg-slate-950 transition-colors duration-300 antialiased">
        
        <!-- Auth View -->
        <div id="authView" class="min-h-screen flex items-center justify-center p-4 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-blue-50 via-white to-slate-50 dark:from-slate-900 dark:via-slate-950 dark:to-slate-900">
            <div class="w-full max-w-md animate-in fade-in slide-in-from-bottom-4 duration-700">
                <div class="text-center mb-10">
                    <img src="../images/logo.svg" alt="tawktoo" class="h-10 mx-auto mb-6">
                    <h1 class="text-3xl font-extrabold text-slate-900 dark:text-white mb-2 tracking-tight">Developer Portal</h1>
                    <p class="text-slate-500 dark:text-slate-400 font-medium">Empowering your real-time experiences</p>
                </div>

                <div class="bg-white dark:bg-slate-900 rounded-3xl p-8 shadow-2xl border border-slate-200 dark:border-slate-800">
                    <!-- Tab Switcher -->
                    <div class="flex p-1 bg-slate-100 dark:bg-slate-800 rounded-2xl mb-8">
                        <button onclick="switchAuthTab('login')" id="loginTabBtn" class="flex-1 py-3 text-sm font-bold rounded-xl transition-all duration-200 bg-white dark:bg-slate-700 text-brand-600 dark:text-white shadow-sm">Sign In</button>
                        <button onclick="switchAuthTab('register')" id="registerTabBtn" class="flex-1 py-3 text-sm font-semibold rounded-xl transition-all duration-200 text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200">Create Account</button>
                    </div>

                    <!-- Login Form -->
                    <form id="loginForm" class="space-y-6">
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-slate-700 dark:text-slate-300">Email Address</label>
                            <input type="email" id="loginEmail" required class="w-full px-4 py-3.5 rounded-xl bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 focus:ring-4 focus:ring-brand-500/10 focus:border-brand-500 outline-none transition-all" placeholder="name@company.com">
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <label class="text-sm font-bold text-slate-700 dark:text-slate-300">Password</label>
                                <a href="javascript:void(0)" onclick="handleForgotPassword()" class="text-xs font-semibold text-brand-600 dark:text-brand-400">Forgot?</a>
                            </div>
                            <input type="password" id="loginPassword" required class="w-full px-4 py-3.5 rounded-xl bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 focus:ring-4 focus:ring-brand-500/10 focus:border-brand-500 outline-none transition-all" placeholder="••••••••">
                        </div>
                        <button type="submit" id="loginBtn" class="w-full py-4 rounded-2xl bg-brand-600 hover:bg-brand-700 text-white font-bold shadow-lg shadow-brand-500/20 transition-all hover:scale-[1.01] active:scale-95">Sign In to Dashboard</button>
                        
                        <div class="relative py-4">
                            <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-slate-100 dark:border-slate-800"></div></div>
                            <div class="relative flex justify-center text-xs uppercase"><span class="bg-white dark:bg-slate-900 px-4 text-slate-400 font-bold tracking-widest">Or secure access</span></div>
                        </div>
                        
                        <button type="button" onclick="handleOTPLogin()" class="w-full py-4 rounded-2xl bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-300 font-bold transition-all flex items-center justify-center gap-2 group">
                            <i class="fas fa-shield-alt text-brand-500 group-hover:scale-110 transition-transform"></i>
                            Sign In with OTP
                        </button>
                    </form>

                    <!-- Register Form -->
                    <form id="registerForm" class="hidden space-y-5">
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-slate-700 dark:text-slate-300">Full Name / Company</label>
                            <input type="text" id="regName" required class="w-full px-4 py-3.5 rounded-xl bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 focus:ring-4 focus:ring-brand-500/10 focus:border-brand-500 outline-none transition-all" placeholder="Acme Inc.">
                        </div>
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-slate-700 dark:text-slate-300">Official Email</label>
                            <input type="email" id="regEmail" required class="w-full px-4 py-3.5 rounded-xl bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 focus:ring-4 focus:ring-brand-500/10 focus:border-brand-500 outline-none transition-all" placeholder="name@company.com">
                        </div>
                        <div class="space-y-2">
                            <label class="text-sm font-bold text-slate-700 dark:text-slate-300">Create Password</label>
                            <input type="password" id="regPassword" required class="w-full px-4 py-3.5 rounded-xl bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 focus:ring-4 focus:ring-brand-500/10 focus:border-brand-500 outline-none transition-all" placeholder="••••••••">
                        </div>
                        <div class="flex items-center gap-3 py-2">
                            <input type="checkbox" required class="w-5 h-5 rounded-lg border-slate-300 text-brand-600 focus:ring-brand-500">
                            <span class="text-xs text-slate-500 font-medium">I agree to the <a href="#" class="text-brand-600 underline">Terms of Service</a></span>
                        </div>
                        <button type="submit" id="registerBtn" class="w-full py-4 rounded-2xl bg-brand-600 hover:bg-brand-700 text-white font-bold shadow-lg shadow-brand-500/20 transition-all hover:scale-[1.01] active:scale-95">Create Developer Account</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Dashboard Layout -->
        <div id="dashboardView" class="hidden flex min-h-screen">
            <!-- Sidebar -->
            <aside class="sidebar flex flex-col fixed inset-y-0 shadow-2xl z-40">
                <div class="h-20 flex items-center px-8 border-b border-slate-100 dark:border-slate-800">
                    <img src="../images/logo.svg" alt="logo" class="h-8">
                </div>
                
                <nav class="flex-1 p-6 space-y-2">
                    <button onclick="switchView('dashboard')" class="nav-link w-full flex items-center gap-4 px-4 py-3 rounded-2xl transition-all group active-nav">
                        <i class="fas fa-home text-brand-500 group-hover:scale-110 transition-transform"></i>
                        <span class="font-bold text-slate-900 dark:text-white">Dashboard</span>
                    </button>
                    <button onclick="switchView('keys')" class="nav-link w-full flex items-center gap-4 px-4 py-3 rounded-2xl transition-all group">
                        <i class="fas fa-key text-slate-400 dark:text-slate-500 group-hover:text-brand-500 group-hover:scale-110 transition-transform"></i>
                        <span class="font-semibold text-slate-600 dark:text-slate-400 group-hover:text-brand-600">API Keys</span>
                    </button>
                    <button onclick="switchView('docs')" class="nav-link w-full flex items-center gap-4 px-4 py-3 rounded-2xl transition-all group">
                        <i class="fas fa-book text-slate-400 dark:text-slate-500 group-hover:text-brand-500 group-hover:scale-110 transition-transform"></i>
                        <span class="font-semibold text-slate-600 dark:text-slate-400 group-hover:text-brand-600">Documentation</span>
                    </button>
                    <button onclick="switchView('analytics')" class="nav-link w-full flex items-center gap-4 px-4 py-3 rounded-2xl transition-all group">
                        <i class="fas fa-chart-line text-slate-400 dark:text-slate-500 group-hover:text-brand-500 group-hover:scale-110 transition-transform"></i>
                        <span class="font-semibold text-slate-600 dark:text-slate-400 group-hover:text-brand-600">Analytics</span>
                    </button>
                </nav>

                <div class="p-6 border-t border-slate-100 dark:border-slate-800">
                    <div class="p-4 rounded-2xl bg-slate-50 dark:bg-slate-800/50 mb-4">
                        <p class="text-[10px] uppercase font-bold text-slate-400 mb-1">Current Plan</p>
                        <p class="text-xs font-bold text-brand-600">Developer Cloud <span class="ml-1 px-1 bg-brand-100 text-brand-700 rounded text-[9px]">Trial</span></p>
                    </div>
                    <button onclick="logout()" class="w-full flex items-center gap-3 px-4 py-3 rounded-2xl text-slate-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/10 transition-all font-semibold italic">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Disconnect</span>
                    </button>
                </div>
            </aside>

            <!-- Main Content Container -->
            <div class="content-area flex-1 flex flex-col">
                <!-- Top Header -->
                <header class="h-20 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md sticky top-0 z-30 px-8 flex items-center justify-between border-b border-slate-100 dark:border-slate-800">
                    <div class="flex items-center gap-4 lg:hidden">
                        <button onclick="toggleMobileMenu()" class="p-2 rounded-lg bg-slate-100 dark:bg-slate-800">
                            <i class="fas fa-bars"></i>
                        </button>
                    </div>
                    <div class="flex items-center gap-3">
                        <h2 id="viewTitle" class="text-xl font-extrabold text-slate-900 dark:text-white tracking-tight">Overview</h2>
                    </div>
                    
                    <div class="flex items-center gap-6">
                        <div id="serverTime" class="hidden md:block text-xs font-bold font-mono text-slate-400 italic"></div>
                        <button onclick="toggleTheme()" class="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 text-slate-500 flex items-center justify-center transition-all hover:scale-110">
                            <i class="fas fa-moon dark:hidden"></i>
                            <i class="fas fa-sun hidden dark:block"></i>
                        </button>
                        <div class="flex items-center gap-3 pl-6 border-l border-slate-100 dark:border-slate-800">
                            <div class="w-10 h-10 rounded-2xl bg-brand-500 text-white flex items-center justify-center font-bold shadow-lg shadow-brand-500/20">
                                <span id="userInitial">D</span>
                            </div>
                            <div class="hidden sm:block">
                                <p id="userName" class="text-sm font-bold text-slate-900 dark:text-white leading-none">Developer</p>
                                <p class="text-[10px] font-bold text-slate-400 mt-1 uppercase">Owner</p>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Dynamic Views -->
                <div class="p-8 pb-12 animate-in fade-in duration-500">
                    
                    <!-- Dashboard Section -->
                    <div id="section-dashboard" class="space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div class="glass-panel p-6 rounded-3xl">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="w-12 h-12 rounded-2xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600">
                                        <i class="fas fa-rocket"></i>
                                    </div>
                                    <span class="text-[10px] font-bold text-slate-400 uppercase">System</span>
                                </div>
                                <p class="text-slate-500 text-xs font-semibold">API Status</p>
                                <h3 class="text-2xl font-extrabold text-slate-900 dark:text-white transition-all">Operational</h3>
                            </div>
                            <div class="glass-panel p-6 rounded-3xl">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="w-12 h-12 rounded-2xl bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center text-indigo-600">
                                        <i class="fas fa-key"></i>
                                    </div>
                                    <span class="text-[10px] font-bold text-slate-400 uppercase">Inventory</span>
                                </div>
                                <p class="text-slate-500 text-xs font-semibold">Total API Keys</p>
                                <h3 id="statTotalKeys" class="text-2xl font-extrabold text-slate-900 dark:text-white">0</h3>
                            </div>
                            <div class="glass-panel p-6 rounded-3xl">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="w-12 h-12 rounded-2xl bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center text-emerald-600">
                                        <i class="fas fa-bolt"></i>
                                    </div>
                                    <span class="text-[10px] font-bold text-slate-400 uppercase">Activity</span>
                                </div>
                                <p class="text-slate-500 text-xs font-semibold">Requests (24h)</p>
                                <h3 id="statTotalUsage" class="text-2xl font-extrabold text-slate-900 dark:text-white">0</h3>
                            </div>
                            <div class="glass-panel p-6 rounded-3xl">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="w-12 h-12 rounded-2xl bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-600">
                                        <i class="fas fa-credit-card"></i>
                                    </div>
                                    <span class="text-[10px] font-bold text-slate-400 uppercase">Usage</span>
                                </div>
                                <p class="text-slate-500 text-xs font-semibold">Daily Quota</p>
                                <h3 class="text-2xl font-extrabold text-slate-900 dark:text-white uppercase text-slate-400 italic">Unlimited</h3>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                            <!-- Recent Analytics -->
                            <div class="glass-panel p-8 rounded-3xl">
                                <div class="flex items-center justify-between mb-8">
                                    <div>
                                        <h4 class="text-lg font-extrabold text-slate-800 dark:text-white tracking-tight">API Activity</h4>
                                        <p class="text-xs font-semibold text-slate-400">Past 7 days volume</p>
                                    </div>
                                    <div class="flex gap-2">
                                        <span class="w-3 h-3 rounded-full bg-brand-500"></span>
                                        <span class="text-[10px] font-bold text-slate-500 uppercase">Meetings</span>
                                    </div>
                                </div>
                                <div class="h-[250px] w-full">
                                    <canvas id="usageChart"></canvas>
                                </div>
                            </div>

                            <!-- Integration Sneak-peek -->
                            <div class="glass-panel p-8 rounded-3xl flex flex-col justify-between overflow-hidden relative">
                                <div class="relative z-10">
                                    <h4 class="text-lg font-extrabold text-slate-800 dark:text-white tracking-tight">Quick Connect</h4>
                                    <p class="text-xs font-semibold text-slate-500 mb-6">Start building in seconds</p>
                                    
                                    <div class="space-y-4">
                                        <div class="p-4 rounded-2xl bg-slate-950 font-mono text-[11px] text-blue-300 relative group">
                                            <span class="text-slate-600"># cURL endpoint</span><br>
                                            <span class="text-brand-400">POST</span> /api/v1/meeting
                                        </div>
                                        <button onclick="switchView('docs')" class="group flex items-center gap-2 text-sm font-bold text-brand-600 hover:text-brand-700 transition-all">
                                            Read API Reference <i class="fas fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                                        </button>
                                    </div>
                                </div>
                                <i class="fas fa-terminal absolute -right-8 -bottom-8 text-slate-100 dark:text-slate-800/20 text-[180px] -rotate-12"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Keys Section -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
                            <div>
                                <h3 class="text-3xl font-extrabold text-slate-900 dark:text-white mb-1 tracking-tight">API Secrets</h3>
                                <p class="text-sm font-medium text-slate-400">Authenticating your cloud applications</p>
                            </div>
                            <button onclick="generateKey()" class="px-6 py-3 rounded-2xl bg-brand-600 hover:bg-brand-700 text-white font-bold text-xs transition-all active:scale-95 flex items-center gap-2">
                                <i class="fas fa-plus"></i>
                                Create New Secret
                            </button>
                        </div>
                        
                        <div class="glass-panel rounded-[32px] overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full pro-table">
                                    <thead>
                                        <tr>
                                            <th>Label</th>
                                            <th>Internal Prefix</th>
                                            <th>Issued On</th>
                                            <th>Status</th>
                                            <th class="text-right pr-10">Manage</th>
                                        </tr>
                                    </thead>
                                    <tbody id="keysTableBody">
                                        <!-- Dynamic content -->
                                    </tbody>
                                </table>
                            </div>
                            <div id="noKeysPlaceholder" class="hidden py-32 text-center space-y-6">
                                <div class="w-24 h-24 rounded-[32px] bg-slate-50 dark:bg-slate-800/50 flex items-center justify-center mx-auto text-slate-200 dark:text-slate-700 border border-dashed border-slate-200 dark:border-slate-800">
                                    <i class="fas fa-key text-3xl"></i>
                                </div>
                                <div>
                                    <p class="text-slate-900 dark:text-white font-bold text-lg">No active secrets found</p>
                                    <p class="text-slate-400 text-sm italic">Secure your first application by generating a key above.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Documentation Section -->
                    <div id="section-docs" class="hidden space-y-8 max-w-4xl">
                        <div>
                            <h3 class="text-2xl font-extrabold text-slate-900 dark:text-white tracking-tight">API Reference</h3>
                            <p class="text-sm font-semibold text-slate-500 italic">Endpoints, schemas, and implementation guides</p>
                        </div>

                        <div class="space-y-6">
                            <div class="p-1 bg-slate-100 dark:bg-slate-800 rounded-2xl flex gap-2 w-fit">
                                <button onclick="switchDocTab('curl')" class="doc-tab active px-6 py-2.5 rounded-xl text-sm font-bold transition-all">cURL</button>
                                <button onclick="switchDocTab('nodejs')" class="doc-tab px-6 py-2.5 rounded-xl text-sm font-bold transition-all">Node.js</button>
                                <button onclick="switchDocTab('python')" class="doc-tab px-6 py-2.5 rounded-xl text-sm font-bold transition-all">Python</button>
                            </div>

                            <div class="code-block animate-in fade-in duration-300">
                                <div class="code-header">
                                    <div class="flex gap-2">
                                        <span class="w-3 h-3 rounded-full bg-red-500/50"></span>
                                        <span class="w-3 h-3 rounded-full bg-yellow-500/50"></span>
                                        <span class="w-3 h-3 rounded-full bg-green-500/50"></span>
                                    </div>
                                    <button onclick="copyDocCode()" class="text-[10px] font-bold text-slate-500 hover:text-white transition-colors uppercase tracking-widest flex items-center gap-2">
                                        <i class="fas fa-copy"></i> Copy
                                    </button>
                                </div>
                                <div class="p-6 overflow-x-auto">
                                    <pre id="codeDisplay" class="font-mono text-xs text-brand-200 leading-relaxed"></pre>
                                </div>
                            </div>

                            <div class="p-8 rounded-3xl bg-blue-50 dark:bg-brand-900/10 border border-blue-100 dark:border-brand-900/30">
                                <div class="flex gap-4">
                                    <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white shrink-0">
                                        <i class="fas fa-info-circle"></i>
                                    </div>
                                    <div>
                                        <h5 class="text-sm font-bold text-blue-900 dark:text-brand-400 mb-1">Authentication Header</h5>
                                        <p class="text-xs text-blue-800 dark:text-brand-300 leading-relaxed">All requests must include the <code class="bg-white/50 dark:bg-white/5 px-1.5 py-0.5 rounded font-bold font-mono">x-api-key</code> header. The key consists of two parts: your unique prefix and the secret key (e.g., <code class="font-mono opacity-80 italic">prefix.secret</code>).</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Analytics Section -->
                    <div id="section-analytics" class="hidden space-y-8">
                        <div>
                            <h3 class="text-2xl font-extrabold text-slate-900 dark:text-white tracking-tight">Usage Analytics</h3>
                            <p class="text-sm font-semibold text-slate-500 italic">Traffic volume and consumption limits</p>
                        </div>
                        <div class="glass-panel p-8 rounded-[40px]">
                            <div class="h-[400px] w-full">
                                <canvas id="usageChartFull"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dynamic Content Template Scripts -->
        <script>
            const API_URL = '/api/v1';
            let token = localStorage.getItem('dev_token');
            let currentView = 'dashboard';
            let chartInstance = null;

            // Documentation Content
            const DOCS = {
                curl: `# Create a new meeting room\ncurl -X POST "\${ORIGIN}/api/v1/meeting" \\\n  -H "x-api-key: YOUR_API_KEY_HERE" \\\n  -H "Content-Type: application/json"`,
                nodejs: `const axios = require('axios');\n\nconst createMeeting = async () => {\n  const response = await axios.post('\${ORIGIN}/api/v1/meeting', {}, {\n    headers: { 'x-api-key': 'YOUR_API_KEY_HERE' }\n  });\n  console.log('Room URL:', response.data.meeting);\n};`,
                python: `import requests\n\nurl = "\${ORIGIN}/api/v1/meeting"\nheaders = {"x-api-key": "YOUR_API_KEY_HERE"}\n\nresponse = requests.post(url, headers=headers)\nprint("Room URL:", response.json().get("meeting"))`
            };

            // Initialize App
            document.addEventListener('DOMContentLoaded', () => {
                if (token) initDashboard();
                updateClock();
                setInterval(updateClock, 1000);
            });

            function updateClock() {
                const clock = document.getElementById('serverTime');
                if (clock) clock.textContent = new Date().toLocaleTimeString('en-US', { hour12: false });
            }

            function switchAuthTab(tab) {
                const isLogin = tab === 'login';
                document.getElementById('loginTabBtn').className = isLogin ? 'flex-1 py-3 text-sm font-bold rounded-xl transition-all duration-200 bg-white dark:bg-slate-700 text-brand-600 dark:text-white shadow-sm' : 'flex-1 py-3 text-sm font-semibold rounded-xl transition-all duration-200 text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200';
                document.getElementById('registerTabBtn').className = !isLogin ? 'flex-1 py-3 text-sm font-bold rounded-xl transition-all duration-200 bg-white dark:bg-slate-700 text-brand-600 dark:text-white shadow-sm' : 'flex-1 py-3 text-sm font-semibold rounded-xl transition-all duration-200 text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200';
                document.getElementById('loginForm').classList.toggle('hidden', !isLogin);
                document.getElementById('registerForm').classList.toggle('hidden', isLogin);
            }

            function initDashboard() {
                document.getElementById('authView').classList.add('hidden');
                document.getElementById('dashboardView').classList.remove('hidden');
                const name = localStorage.getItem('dev_name') || 'Developer';
                document.getElementById('userName').textContent = name;
                document.getElementById('userInitial').textContent = name[0].toUpperCase();
                switchView('dashboard');
            }

            function switchView(view) {
                currentView = view;
                const sections = ['dashboard', 'keys', 'docs', 'analytics'];
                sections.forEach(s => document.getElementById(`section-${s}`).classList.toggle('hidden', s !== view));
                
                // Update Nav Links
                document.querySelectorAll('.nav-link').forEach(link => {
                    const isTarget = link.querySelector('span').textContent.toLowerCase().includes(view);
                    link.className = `nav-link w-full flex items-center gap-4 px-4 py-3 rounded-2xl transition-all group ${isTarget ? 'active-nav bg-brand-50 dark:bg-brand-900/20' : ''}`;
                    const icon = link.querySelector('i');
                    if (isTarget) {
                        icon.classList.remove('text-slate-400', 'dark:text-slate-500');
                        icon.classList.add('text-brand-500');
                    } else {
                        icon.classList.add('text-slate-400', 'dark:text-slate-500');
                        icon.classList.remove('text-brand-500');
                    }
                });

                document.getElementById('viewTitle').textContent = view.charAt(0).toUpperCase() + view.slice(1);
                
                if (view === 'dashboard' || view === 'analytics') loadUsageStats();
                if (view === 'keys') loadKeys();
                if (view === 'docs') switchDocTab('curl');
            }

            function toggleTheme() {
                document.documentElement.classList.toggle('dark');
            }

            async function loadKeys() {
                try {
                    const res = await axios.get(`${API_URL}/keys`, { headers: { Authorization: `Bearer ${token}` } });
                    const keys = res.data;
                    const container = document.getElementById('keysTableBody');
                    const placeholder = document.getElementById('noKeysPlaceholder');
                    
                    document.getElementById('statTotalKeys').textContent = keys.length;
                    
                    if (keys.length === 0) {
                        placeholder.classList.remove('hidden');
                        container.innerHTML = '';
                        return;
                    }

                    placeholder.classList.add('hidden');
                    container.innerHTML = keys.map(k => `
                        <tr>
                            <td class="font-bold text-slate-900 dark:text-white">${k.name}</td>
                            <td><span class="font-mono text-[10px] text-slate-400 bg-slate-100 dark:bg-slate-800/50 px-2 py-1 rounded-lg">${k.prefix}••••</span></td>
                            <td class="text-xs font-semibold text-slate-400">${new Date(k.createdAt).toLocaleDateString()}</td>
                            <td>
                                <span class="px-3 py-1 rounded-full text-[9px] font-extrabold uppercase tracking-widest ${k.is_active ? 'bg-emerald-50 text-emerald-600 border border-emerald-100 dark:bg-emerald-900/20 dark:text-emerald-400 dark:border-emerald-800/50' : 'bg-slate-100 text-slate-500 border border-slate-200 dark:bg-slate-800 dark:text-slate-500 dark:border-slate-700'}">
                                    ${k.is_active ? 'Online' : 'Revoked'}
                                </span>
                            </td>
                            <td class="text-right pr-6">
                                <div class="flex justify-end items-center gap-2">
                                    <button onclick="copyPrefix('${k.prefix}')" title="Copy Prefix" class="p-2.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-400 hover:text-brand-500 transition-all"><i class="fas fa-copy text-xs"></i></button>
                                    <button onclick="toggleKey('${k.id}', ${k.is_active})" title="${k.is_active ? 'Revoke' : 'Restore'}" class="p-2.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-400 ${k.is_active ? 'hover:text-amber-500' : 'hover:text-emerald-500'} transition-all"><i class="fas ${k.is_active ? 'fa-shield-slash' : 'fa-check-circle'} text-xs"></i></button>
                                    <button onclick="deleteKey('${k.id}')" title="Delete Permanently" class="p-2.5 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-400 hover:text-red-500 transition-all"><i class="fas fa-trash-alt text-xs"></i></button>
                                </div>
                            </td>
                        </tr>
                    `).join('');
                } catch (e) { console.error('Key load fail', e); }
            }

            async function generateKey() {
                const { value: name } = await Swal.fire({
                    title: 'New API Secret',
                    input: 'text',
                    inputPlaceholder: 'Key Name (e.g. My Next.js App)',
                    showCancelButton: true,
                    confirmButtonText: 'Generate',
                    confirmButtonColor: '#3b68f8',
                    customClass: { popup: 'rounded-[32px] border-none shadow-2xl dark:bg-slate-900 dark:text-white', input: 'rounded-xl border-slate-200 dark:border-slate-800 dark:bg-slate-800 focus:ring-brand-500/10' }
                });

                if (!name) return;
                try {
                    const res = await axios.post(`${API_URL}/keys`, { name }, { headers: { Authorization: `Bearer ${token}` } });
                    if (res.data?.apiKey) {
                        await Swal.fire({
                            icon: 'success',
                            title: 'Secret Key Generated',
                            html: `<div class="p-4 rounded-2xl bg-slate-950 text-brand-300 font-mono text-left text-xs break-all selection:bg-brand-500 selection:text-white scrollbar-hide select-all">${res.data.apiKey}</div>
                                   <p class="mt-4 text-[11px] font-bold text-slate-400 italic">Save this securely. It will not be revealed again.</p>`,
                            confirmButtonText: 'I have copied it',
                            confirmButtonColor: '#3b68f8'
                        });
                        loadKeys();
                    }
                } catch (e) { Swal.fire('Error', 'Failed to generate key', 'error'); }
            }

            async function toggleKey(id, status) {
                 try {
                    await axios.patch(`${API_URL}/keys/${id}`, { is_active: !status }, { headers: { Authorization: `Bearer ${token}` } });
                    loadKeys();
                    Swal.fire({ toast: true, position: 'top-end', icon: 'success', title: 'Key status updated', showConfirmButton: false, timer: 1500 });
                } catch (e) { Swal.fire('Error', 'Update failed', 'error'); }
            }

            async function deleteKey(id) {
                const r = await Swal.fire({ title: 'Delete Key?', text: "Permanent removal!", icon: 'warning', showCancelButton: true, confirmButtonColor: '#ef4444' });
                if (!r.isConfirmed) return;
                try {
                    await axios.delete(`${API_URL}/keys/${id}`, { headers: { Authorization: `Bearer ${token}` } });
                    loadKeys();
                    Swal.fire({ toast: true, position: 'top-end', icon: 'success', title: 'Key deleted', showConfirmButton: false, timer: 1500 });
                } catch (e) { Swal.fire('Error', 'Delete failed', 'error'); }
            }

            function copyPrefix(prefix) {
                navigator.clipboard.writeText(prefix);
                Swal.fire({ toast: true, position: 'top-end', icon: 'success', title: 'Prefix copied', showConfirmButton: false, timer: 1500 });
            }

            function switchDocTab(tab) {
                const tabs = document.querySelectorAll('.doc-tab');
                tabs.forEach(t => {
                    const active = t.textContent.toLowerCase().includes(tab);
                    t.className = `doc-tab px-6 py-2.5 rounded-xl text-sm font-bold transition-all ${active ? 'bg-white dark:bg-slate-700 text-brand-600 dark:text-white shadow-sm' : 'text-slate-500 hover:text-slate-700 dark:text-slate-400'}`;
                });
                
                const code = DOCS[tab].replace(/\$\{ORIGIN\}/g, window.location.origin);
                document.getElementById('codeDisplay').textContent = code;
            }

            function copyDocCode() {
                navigator.clipboard.writeText(document.getElementById('codeDisplay').textContent);
                Swal.fire({ toast: true, position: 'top-end', icon: 'success', title: 'Copied to clipboard', showConfirmButton: false, timer: 1500 });
            }

            async function loadUsageStats() {
                try {
                    const res = await axios.get(`${API_URL}/stats/usage`, { headers: { Authorization: `Bearer ${token}` } });
                    const data = res.data;
                    const labels = data.map(d => d.date);
                    const values = data.map(d => d.count);
                    
                    document.getElementById('statTotalUsage').textContent = values.reduce((a, b) => a + b, 0);

                    const target = currentView === 'dashboard' ? 'usageChart' : 'usageChartFull';
                    const ctx = document.getElementById(target).getContext('2d');
                    
                    if (chartInstance) chartInstance.destroy();
                    
                    const grad = ctx.createLinearGradient(0, 0, 0, 400);
                    grad.addColorStop(0, 'rgba(59, 104, 248, 0.2)');
                    grad.addColorStop(1, 'rgba(59, 104, 248, 0)');

                    chartInstance = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels,
                            datasets: [{
                                label: 'API Hits',
                                data: values,
                                borderColor: '#3b68f8',
                                backgroundColor: grad,
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointRadius: 0,
                                pointHoverRadius: 6,
                                pointHoverBackgroundColor: '#3b68f8',
                                pointHoverBorderColor: '#fff',
                                pointHoverBorderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                x: { grid: { display: false }, ticks: { color: '#94a3b8', font: { size: 10, weight: '600' } } },
                                y: { grid: { color: 'rgba(148, 163, 184, 0.05)' }, ticks: { color: '#94a3b8', font: { size: 10, weight: '600' }, precision: 0 } }
                            }
                        }
                    });
                } catch (e) { console.error('Stats load fail', e); }
            }

            // Auth Logic
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const b = document.getElementById('loginBtn');
                b.disabled = true; b.textContent = 'Authenticating...';
                try {
                    const email = document.getElementById('loginEmail').value;
                    const res = await axios.post(`${API_URL}/auth/login`, { email, password: document.getElementById('loginPassword').value });
                    if (res.data.token) {
                        localStorage.setItem('dev_token', res.data.token);
                        localStorage.setItem('dev_name', res.data.name || email);
                        token = res.data.token;
                        initDashboard();
                    }
                } catch (e) { Swal.fire('Error', e.response?.data?.message || 'Login failed', 'error'); }
                finally { b.disabled = false; b.textContent = 'Sign In to Dashboard'; }
            });

            document.getElementById('registerForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const b = document.getElementById('registerBtn');
                b.disabled = true; b.textContent = 'Creating account...';
                try {
                    const email = document.getElementById('regEmail').value;
                    await axios.post(`${API_URL}/auth/register`, { name: document.getElementById('regName').value, email, password: document.getElementById('regPassword').value });
                    Swal.fire('Success', 'Account created! Please sign in.', 'success');
                    switchAuthTab('login');
                    document.getElementById('loginEmail').value = email;
                } catch (e) { Swal.fire('Error', e.response?.data?.message || 'Registration failed', 'error'); }
                finally { b.disabled = false; b.textContent = 'Create Developer Account'; }
            });

            // Author: Sanket - Forgot Password & OTP Flow
            async function handleForgotPassword() {
                const { value: email } = await Swal.fire({
                    title: 'Reset Password',
                    input: 'email',
                    inputPlaceholder: 'Enter your account email',
                    showCancelButton: true,
                    confirmButtonText: 'Send Reset Code',
                    confirmButtonColor: '#3b68f8',
                    customClass: { popup: 'rounded-[32px] dark:bg-slate-900 dark:text-white', input: 'rounded-xl border-slate-200 dark:border-slate-800 dark:bg-slate-800' }
                });

                if (!email) return;

                Swal.fire({ title: 'Sending...', allowOutsideClick: false, didOpen: () => { Swal.showLoading(); } });

                try {
                    await axios.post(`${API_URL}/auth/otp/send`, { email });
                    
                    const { value: otp } = await Swal.fire({
                        title: 'Verify Code',
                        text: `Enter the 6-digit code sent to ${email}`,
                        input: 'text',
                        inputAttributes: { maxlength: 6, style: 'text-align: center; letter-spacing: 0.5em; font-weight: bold;' },
                        showCancelButton: true,
                        confirmButtonText: 'Verify & Reset',
                        confirmButtonColor: '#3b68f8'
                    });

                    if (!otp) return;

                    const { value: passwords } = await Swal.fire({
                        title: 'New Password',
                        html: `
                            <input id="swal-pw1" class="swal2-input rounded-xl border-slate-200" type="password" placeholder="New Password">
                            <input id="swal-pw2" class="swal2-input rounded-xl border-slate-200" type="password" placeholder="Confirm Password">
                        `,
                        focusConfirm: false,
                        preConfirm: () => {
                            const p1 = document.getElementById('swal-pw1').value;
                            const p2 = document.getElementById('swal-pw2').value;
                            if (!p1 || p1 !== p2) {
                                Swal.showValidationMessage('Passwords do not match');
                                return false;
                            }
                            return p1;
                        }
                    });

                    if (!passwords) return;

                    await axios.post(`${API_URL}/auth/password/reset`, { email, otp, newPassword: passwords });
                    Swal.fire('Success', 'Password updated successfully! Please login.', 'success');
                } catch (e) {
                    Swal.fire('Error', e.response?.data?.message || 'Failed to process request', 'error');
                }
            }

            async function handleOTPLogin() {
                const { value: email } = await Swal.fire({
                    title: 'OTP Sign In',
                    input: 'email',
                    inputPlaceholder: 'Enter your account email',
                    showCancelButton: true,
                    confirmButtonText: 'Send Code',
                    confirmButtonColor: '#3b68f8',
                    customClass: { popup: 'rounded-[32px] dark:bg-slate-900 dark:text-white', input: 'rounded-xl border-slate-200 dark:border-slate-800 dark:bg-slate-800' }
                });

                if (!email) return;

                Swal.fire({ title: 'Sending code...', allowOutsideClick: false, didOpen: () => { Swal.showLoading(); } });

                try {
                    await axios.post(`${API_URL}/auth/otp/send`, { email });
                    
                    const { value: otp } = await Swal.fire({
                        title: 'Verify Access',
                        text: `Enter the secure code sent to ${email}`,
                        input: 'text',
                        inputAttributes: { maxlength: 6, style: 'text-align: center; letter-spacing: 0.5em; font-weight: bold;' },
                        showCancelButton: true,
                        confirmButtonText: 'Secure Login',
                        confirmButtonColor: '#3b68f8'
                    });

                    if (!otp) return;

                    const res = await axios.post(`${API_URL}/auth/otp/login`, { email, otp });
                    if (res.data.token) {
                        localStorage.setItem('dev_token', res.data.token);
                        localStorage.setItem('dev_name', res.data.name || email);
                        token = res.data.token;
                        initDashboard();
                        Swal.fire({ toast: true, position: 'top-end', icon: 'success', title: 'Authenticated via OTP', showConfirmButton: false, timer: 2000 });
                    }
                } catch (e) {
                    Swal.fire('Error', e.response?.data?.message || 'Verification failed', 'error');
                }
            }

            function logout() {
                localStorage.clear();
                location.reload();
            }

            function toggleMobileMenu() {
                document.querySelector('.sidebar').classList.toggle('open');
            }
        </script>
    </body>
</html>
