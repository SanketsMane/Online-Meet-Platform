<!doctype html>
<html lang="en" class="no-js">
    <head>
        <!-- Title and Icon -->
        <title id="title">tawktoo - Host Portal</title>
        <link id="icon" rel="shortcut icon" href="../images/logo.svg" />
        <link id="appleTouchIcon" rel="apple-touch-icon" href="../images/logo.svg" />

        <!-- Meta Information -->
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="tawktoo Host Portal - Secure access for meeting hosts and presenters" />

        <!-- Premium Fonts & Icons -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />

        <!-- Tailwind Configuration -->
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                darkMode: 'class',
                theme: {
                    extend: {
                        fontFamily: { 
                            sans: ['Inter', 'sans-serif'],
                            heading: ['Outfit', 'sans-serif']
                        },
                        colors: {
                            brand: { 50: '#f5f7ff', 100: '#ebf0fe', 200: '#ced9fd', 300: '#b1c2fc', 400: '#7695fa', 500: '#3b68f8', 600: '#355de0', 700: '#2c4ebb', 800: '#233e95', 900: '#1d337a' },
                            slate: { 900: '#0f172a', 800: '#1e293b', 700: '#334155' }
                        },
                        animation: {
                            'float': 'float 6s ease-in-out infinite',
                            'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        },
                        keyframes: {
                            float: {
                                '0%, 100%': { transform: 'translateY(0)' },
                                '50%': { transform: 'translateY(-20px)' },
                            }
                        }
                    }
                }
            }
        </script>

        <style>
            body { font-family: 'Inter', sans-serif; }
            
            /* Custom Scrollbar */
            ::-webkit-scrollbar { width: 6px; height: 6px; }
            ::-webkit-scrollbar-track { background: transparent; }
            ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 9999px; }

            /* Modern Input Focus */
            input:focus { outline: none; border-color: #3b68f8; box-shadow: 0 0 0 4px rgba(59,104,248,0.1); }
        </style>

        <!-- Functional Scripts -->
        <script defer src="../js/Brand.js"></script>
        <script defer src="../js/components.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <link rel="stylesheet" type="text/css" href="../css/theme.css" />
    </head>
    <body class="dark:bg-slate-950 transition-colors duration-300 antialiased min-h-screen flex flex-col">
        
        <header class="site-header-shared"></header>

        <!-- Auth View -->
        <main class="flex-1 flex items-center justify-center p-4 bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-blue-50 via-white to-slate-50 dark:from-slate-900 dark:via-slate-950 dark:to-slate-900">
            <div class="w-full max-w-md animate-in fade-in slide-in-from-bottom-4 duration-700">
                <div class="text-center mb-10">
                    <img src="../images/logo.svg" alt="tawktoo" class="h-10 mx-auto mb-6">
                    <h1 class="text-3xl font-extrabold text-slate-900 dark:text-white mb-2 tracking-tight">Host Portal</h1>
                    <p class="text-slate-500 dark:text-slate-400 font-medium">Secure access to your meetings</p>
                </div>

                <div class="bg-white dark:bg-slate-900 rounded-3xl p-8 shadow-2xl border border-slate-200 dark:border-slate-800">
                    <!-- Tab Switcher -->
                    <div class="flex p-1 bg-slate-100 dark:bg-slate-800 rounded-2xl mb-8">
                        <button onclick="switchTab('login')" id="loginTabBtn" class="flex-1 py-3 text-sm font-bold rounded-xl transition-all duration-200 bg-white dark:bg-slate-700 text-brand-600 dark:text-white shadow-sm auth-tab">Sign In</button>
                        <button onclick="switchTab('register')" id="registerTabBtn" class="flex-1 py-3 text-sm font-semibold rounded-xl transition-all duration-200 text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 auth-tab">Create Account</button>
                    </div>

                    <!-- Error Alert -->
                    <div id="errorMessage" class="hidden mb-6 p-4 rounded-xl bg-red-500/10 border border-red-500/20 text-red-500 text-xs font-semibold flex items-center gap-3 animate-in slide-in-from-top-2">
                        <i class="fas fa-exclamation-circle text-sm"></i>
                        <span class="flex-1"></span>
                    </div>

                    <!-- Login Form -->
                    <div id="loginPanel" class="tab-panel space-y-6">
                        <form id="loginForm" class="space-y-6">
                            <div class="space-y-2">
                                <label class="text-sm font-bold text-slate-700 dark:text-slate-300">Username</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400">
                                        <i class="fas fa-at text-xs"></i>
                                    </div>
                                    <input id="username" type="text" required class="w-full pl-10 pr-4 py-3.5 rounded-xl bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 outline-none transition-all text-sm" placeholder="your_handle">
                                </div>
                            </div>

                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <label class="text-sm font-bold text-slate-700 dark:text-slate-300">Password</label>
                                    <a href="#" onclick="handleForgotPassword()" class="text-xs font-semibold text-brand-600 hover:text-brand-700 transition-colors">Forgot?</a>
                                </div>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-slate-400">
                                        <i class="fas fa-lock text-xs"></i>
                                    </div>
                                    <input id="password" type="password" required class="w-full pl-10 pr-12 py-3.5 rounded-xl bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 outline-none transition-all text-sm" placeholder="••••••••">
                                    <button type="button" id="togglePassword" class="absolute inset-y-0 right-0 pr-4 flex items-center text-slate-400 hover:text-brand-500 transition-colors">
                                        <i class="fas fa-eye text-xs"></i>
                                    </button>
                                </div>
                            </div>

                            <button type="submit" id="loginButton" class="w-full py-4 rounded-2xl bg-brand-600 hover:bg-brand-700 text-white font-bold text-sm shadow-xl shadow-brand-500/20 transition-all active:scale-95 flex items-center justify-center gap-2">
                                <span>Sign In to Dashboard</span>
                                <i class="fas fa-arrow-right text-[10px]"></i>
                            </button>
                        </form>
                    </div>

                    <!-- Register Form -->
                    <div id="registerPanel" class="tab-panel hidden space-y-6">
                        <form id="registerForm" class="space-y-5">
                            <div class="space-y-2">
                                <label class="text-sm font-bold text-slate-700 dark:text-slate-300">Desired Username</label>
                                <input id="regUsername" type="text" required class="w-full px-4 py-3.5 rounded-xl bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 outline-none transition-all text-sm" placeholder="your_handle">
                            </div>
                            <div class="space-y-2">
                                <label class="text-sm font-bold text-slate-700 dark:text-slate-300">Display Name</label>
                                <input id="regDisplayname" type="text" required class="w-full px-4 py-3.5 rounded-xl bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 outline-none transition-all text-sm" placeholder="E.g. John Smith">
                            </div>
                            <div class="space-y-2">
                                <label class="text-sm font-bold text-slate-700 dark:text-slate-300">Master Password</label>
                                <input id="regPassword" type="password" required class="w-full px-4 py-3.5 rounded-xl bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 outline-none transition-all text-sm" placeholder="••••••••">
                            </div>
                            <button type="submit" id="registerButton" class="w-full py-4 rounded-2xl bg-emerald-600 hover:bg-emerald-700 text-white font-bold text-sm shadow-xl shadow-emerald-500/20 transition-all active:scale-95 flex items-center justify-center gap-2">
                                <span>Create Host Account</span>
                                <i class="fas fa-plus text-[10px]"></i>
                            </button>
                        </form>
                    </div>

                    <div class="mt-10 text-center pt-8 border-t border-slate-100 dark:border-slate-800">
                        <a href="/" class="text-xs font-bold text-slate-400 hover:text-slate-900 dark:hover:text-white transition-all inline-flex items-center gap-2 group">
                            <i class="fas fa-arrow-left text-[10px] group-hover:-translate-x-1 transition-transform"></i>
                            Back to Home
                        </a>
                    </div>
                </div>
            </div>
        </main>

        <footer class="site-footer-shared"></footer>

        <!-- Scripts -->
        <script>
            // Author: Sanket - Theme management
            document.getElementById('themeToggle').addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
            });

            // Author: Sanket - Tab switching
            function switchTab(tab) {
                const loginPanel = document.getElementById('loginPanel');
                const registerPanel = document.getElementById('registerPanel');
                const loginBtn = document.getElementById('loginTabBtn');
                const regBtn = document.getElementById('registerTabBtn');
                
                const activeClasses = 'bg-white dark:bg-slate-700 text-brand-600 dark:text-white shadow-sm font-bold';
                const inactiveClasses = 'text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 font-semibold';

                loginPanel.classList.toggle('hidden', tab !== 'login');
                registerPanel.classList.toggle('hidden', tab === 'login');

                if (tab === 'login') {
                    loginBtn.className = `flex-1 py-3 text-sm rounded-xl transition-all duration-200 ${activeClasses} auth-tab`;
                    regBtn.className = `flex-1 py-3 text-sm rounded-xl transition-all duration-200 ${inactiveClasses} auth-tab`;
                } else {
                    loginBtn.className = `flex-1 py-3 text-sm rounded-xl transition-all duration-200 ${inactiveClasses} auth-tab`;
                    regBtn.className = `flex-1 py-3 text-sm rounded-xl transition-all duration-200 ${activeClasses} auth-tab`;
                }
            }

            // Author: Sanket - Authentication Logic
            document.addEventListener('DOMContentLoaded', function() {
                const loginForm = document.getElementById('loginForm');
                const loginButton = document.getElementById('loginButton');
                const usernameInput = document.getElementById('username');
                const passwordInput = document.getElementById('password');
                const errorMessage = document.getElementById('errorMessage');

                const registerForm = document.getElementById('registerForm');
                const registerButton = document.getElementById('registerButton');
                const regUsernameInput = document.getElementById('regUsername');
                const regDisplaynameInput = document.getElementById('regDisplayname');
                const regPasswordInput = document.getElementById('regPassword');

                // Password toggle
                const togglePassword = document.getElementById('togglePassword');
                if (togglePassword) {
                    togglePassword.addEventListener('click', function() {
                        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                        passwordInput.setAttribute('type', type);
                        const icon = this.querySelector('i');
                        icon.classList.toggle('fa-eye');
                        icon.classList.toggle('fa-eye-slash');
                    });
                }
                
                // Login handler
                loginForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const username = usernameInput.value.trim();
                    const password = passwordInput.value;

                    if (!username || !password) {
                        showError('Security Error: Credentials required');
                        return;
                    }

                    loginButton.disabled = true;
                    loginButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i><span>Verifying Session...</span>';
                    hideError();

                    try {
                        const response = await axios.post('/login', { username, password });
                        if (response.data && response.data.message) {
                            localStorage.setItem('token', response.data.message);
                            await Swal.fire({
                                icon: 'success',
                                title: 'Access Authorized',
                                text: `Welcome back, ${response.data.displayname || username}`,
                                timer: 2000,
                                showConfirmButton: false,
                                customClass: { 
                                    popup: 'rounded-[40px] dark:bg-slate-900 dark:text-white border border-brand-500/20 text-center'
                                }
                            });
                            window.location.href = '/';
                        }
                    } catch (error) {
                        let errorMsg = 'Access Denied: Please check your parameters.';
                        if (error.response?.data?.message) errorMsg = error.response.data.message;
                        showError(errorMsg);
                    } finally {
                        loginButton.disabled = false;
                        loginButton.innerHTML = '<span>Sign In to Dashboard</span><i class="fas fa-arrow-right text-xs"></i>';
                    }
                });

                // Registration handler
                if (registerForm) {
                    registerForm.addEventListener('submit', async function(e) {
                        e.preventDefault();
                        const username = regUsernameInput.value.trim();
                        const displayname = regDisplaynameInput.value.trim();
                        const password = regPasswordInput.value;

                        if (!username || !password || !displayname) {
                            showError('Incomplete Request: Data Missing');
                            return;
                        }

                        registerButton.disabled = true;
                        registerButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i><span>Processing...</span>';
                        hideError();

                        try {
                            const response = await axios.post('/api/v1/user/register', { username, displayname, password });
                            if (response.status === 201) {
                                await Swal.fire({
                                    icon: 'success',
                                    title: 'Identity Created',
                                    text: 'Profile established successfully. You may now sign in.',
                                    timer: 2000,
                                    showConfirmButton: false,
                                    customClass: { 
                                        popup: 'rounded-[40px] dark:bg-slate-900 dark:text-white border border-emerald-500/20 text-center'
                                    }
                                });
                                switchTab('login');
                                usernameInput.value = username;
                                registerForm.reset();
                            }
                        } catch (error) {
                            let errorMsg = 'Registration Error: Integrity check failed.';
                            if (error.response?.data?.message) errorMsg = error.response.data.message;
                            showError(errorMsg);
                        } finally {
                            registerButton.disabled = false;
                            registerButton.innerHTML = '<span>Create Host Account</span><i class="fas fa-plus text-xs"></i>';
                        }
                    });
                }

                function showError(message) {
                    errorMessage.querySelector('span').textContent = message;
                    errorMessage.classList.remove('hidden');
                }

                function hideError() {
                    errorMessage.classList.add('hidden');
                }

                [usernameInput, passwordInput, regUsernameInput].forEach(el => {
                    if (el) el.addEventListener('input', hideError);
                });
            });

            // Author: Sanket - Recovery placeholder
            function handleForgotPassword() {
                 Swal.fire({
                    title: 'System Notice',
                    text: 'Automated recovery is disabled. Please contact your administrator for manual bypass.',
                    icon: 'info',
                    confirmButtonText: 'Understood',
                    confirmButtonColor: '#2563eb',
                    customClass: { popup: 'rounded-[40px] dark:bg-slate-900 text-center' }
                });
            }
        </script>
    </body>
</html>
